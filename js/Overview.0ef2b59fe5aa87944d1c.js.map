{"version":3,"sources":["webpack://insights-frontend-starter-app/./src/Utilities/overviewRows.js","webpack://insights-frontend-starter-app/./src/routes/Overview.js"],"names":["indexToKey","columns","onSetRows","title","transforms","sortable","cellTransforms","treeTable","nowrap","cellWidth","rowMapper","appName","version","selectedRows","apiName","selected","isSelected","cells","Fragment","Link","to","value","props","Badge","Button","variant","onClick","downloadFile","emptyTable","EmptyTable","Bullseye","EmptyState","EmptyStateVariant","Title","headingLevel","size","EmptyStateBody","colSpan","appVersion","oneApi","name","then","data","latest","fileDownload","JSON","stringify","Overview","loadApis","services","selectRow","onError","useEffect","useState","openedRows","setOpenedRows","sortBy","onSortBy","perPage","page","pageSettings","onPaginate","filter","onChangeFilter","filtered","endpoints","row","restFilterValues","frontend","paths","sub_apps","reduce","acc","curr","id","api","Boolean","some","key","toLocaleLowerCase","indexOf","filterRows","rows","loaded","length","sort","next","getSortKey","obj","localeCompare","sensitivity","sortRows","index","direction","SortByDirection","slice","map","subItems","isTreeOpen","includes","noDetail","Object","entries","versions","treeParent","flat","buildRows","PageHeader","className","Main","PrimaryToolbar","filterConfig","items","label","type","filterValues","placeholder","onChange","_e","isDisabled","actionsConfig","actions","values","zip","JSZip","allFiles","catch","Promise","all","flatten","files","file","generateAsync","content","multiDownload","pagination","itemCount","onSetPage","onPerPageSelect","_event","activeFiltersConfig","filters","onDelete","Table","aria-label","TableVariant","onSort","opened","sizeCalculator","rowWrapper","TreeRowWrapper","onSelect","rowKey","TableHeader","TableBody","SkeletonTable","rowSize","TableToolbar","isFooter","Pagination","dropDirection","propTypes","PropTypes","history","push","defaultProps","connect","dispatch","onLoadApis","onSelectRow","error","addNotification","description","dismissable"],"mappings":"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","file":"js/Overview.0ef2b59fe5aa87944d1c.js","sourcesContent":["import React, { Fragment } from 'react';\nimport {\n  Badge,\n  Bullseye,\n  Button,\n  EmptyState,\n  Title,\n  EmptyStateBody,\n  EmptyStateVariant,\n} from '@patternfly/react-core';\nimport { Link } from 'react-router-dom';\nimport {\n  cellWidth,\n  nowrap,\n  sortable,\n  SortByDirection,\n} from '@patternfly/react-table';\nimport { EmptyTable } from '@redhat-cloud-services/frontend-components';\nimport { ExportIcon } from '@patternfly/react-icons';\nimport { oneApi } from '../api';\nimport fileDownload from 'js-file-download';\nimport JSZip from 'jszip';\nimport flatten from 'lodash/flatten';\nimport { treeTable } from '@redhat-cloud-services/frontend-components/components/TreeTable';\n\nconst indexToKey = ['', 'title', 'appName', 'version']; // pf indexes from 1 not 0\n\nexport const columns = (onSetRows) => [\n  {\n    title: 'Application name',\n    transforms: [sortable],\n    cellTransforms: [treeTable(onSetRows)],\n  },\n  { title: 'API endpoint', transforms: [nowrap, sortable, cellWidth(10)] },\n  { title: 'API version', transforms: [nowrap, sortable, cellWidth(10)] },\n  { title: 'Download', transforms: [cellWidth(10)] },\n];\n\nexport const rowMapper = (\n  title,\n  appName,\n  version,\n  selectedRows = [],\n  apiName\n) => ({\n  selected: selectedRows?.[appName]?.isSelected,\n  cells: [\n    {\n      title: (\n        <Fragment>\n          {version ? <Link to={`/${apiName}`}>{title}</Link> : title}\n        </Fragment>\n      ),\n      value: title,\n      props: {\n        value: title,\n        'data-position': 'title',\n      },\n    },\n    version ? `/api/${apiName}` : '',\n    {\n      title: <Badge>{version}</Badge>,\n      value: version,\n    },\n    {\n      title: (\n        <Button variant=\"plain\" onClick={() => downloadFile(apiName, version)}>\n          {' '}\n          <ExportIcon />{' '}\n        </Button>\n      ),\n    },\n  ],\n});\n\nexport const emptyTable = [\n  {\n    cells: [\n      {\n        title: (\n          <EmptyTable>\n            <Bullseye>\n              <EmptyState variant={EmptyStateVariant.full}>\n                <Title headingLevel=\"h5\" size=\"lg\">\n                  No matching rules found\n                </Title>\n                <EmptyStateBody>\n                  This filter criteria matches no rules. <br /> Try changing\n                  your filter settings.\n                </EmptyStateBody>\n              </EmptyState>\n            </Bullseye>\n          </EmptyTable>\n        ),\n        props: {\n          colSpan: 4,\n        },\n      },\n    ],\n  },\n];\n\nexport function sortRows(curr, next, key = 'title', isDesc) {\n  const getSortKey = (obj) =>\n    key === 'appName' && obj.apiName ? 'apiName' : key;\n  return isDesc\n    ? next[getSortKey(next)]?.localeCompare(curr[getSortKey(curr)], 'en', {\n        sensitivity: 'base',\n      })\n    : curr[getSortKey(curr)]?.localeCompare(next[getSortKey(next)], 'en', {\n        sensitivity: 'base',\n      });\n}\n\nexport function buildRows(\n  sortBy,\n  { page, perPage },\n  rows,\n  selectedRows,\n  openedRows\n) {\n  if (rows.length > 0) {\n    return rows\n      .sort((curr, next) =>\n        sortRows(\n          curr,\n          next,\n          indexToKey[sortBy.index],\n          sortBy.direction === SortByDirection.desc\n        )\n      )\n      .slice((page - 1) * perPage, page * perPage)\n      .map(({ frontend, title, appName, version, apiName, api }, index) => [\n        {\n          ...rowMapper(\n            title,\n            `${api.subItems ? 'parent-' : ''}${apiName || appName}`,\n            version,\n            selectedRows,\n            apiName || appName\n          ),\n          ...(api.subItems && {\n            isTreeOpen: openedRows?.includes?.(\n              (frontend && frontend.title) || title\n            ),\n            subItems: api.subItems,\n          }),\n          noDetail: !version,\n        },\n        ...(api.subItems\n          ? Object.entries(api.subItems).map(\n              ([key, { title, versions, apiName }]) => ({\n                ...rowMapper(\n                  title,\n                  apiName || key,\n                  versions?.[0],\n                  selectedRows,\n                  apiName || key\n                ),\n                treeParent: index,\n              })\n            )\n          : []),\n      ])\n      .flat();\n  }\n\n  return emptyTable;\n}\n\nexport function filterRows(row, filter) {\n  const restFilterValues = [\n    row.frontend?.title,\n    ...(row.frontend?.paths || []),\n    // eslint-disable-next-line camelcase\n    ...(row.frontend?.sub_apps?.reduce(\n      (acc, curr) => [...acc, curr.title, curr.id],\n      []\n    ) || []),\n    row.api?.apiName,\n  ].filter(Boolean);\n  return (\n    indexToKey.some(\n      (key) =>\n        row[key] &&\n        row[key].toLocaleLowerCase().indexOf(filter.toLocaleLowerCase()) !== -1\n    ) ||\n    restFilterValues.some(\n      (value) =>\n        value.toLocaleLowerCase().indexOf(filter.toLocaleLowerCase()) !== -1\n    )\n  );\n}\n\nexport function downloadFile(appName, appVersion) {\n  oneApi({ name: appName, version: appVersion }).then((data) => {\n    delete data.latest;\n    delete data.name;\n    fileDownload(JSON.stringify(data), `${appName}-openapi.json`);\n  });\n}\n\nexport function multiDownload(selectedRows = {}, onError) {\n  const zip = new JSZip();\n  const allFiles = Object.values(selectedRows)\n    .filter(({ isSelected }) => isSelected)\n    .map(({ appName, version, apiName, subItems }) => {\n      if (subItems) {\n        return Object.entries(subItems).map(([key, { versions }]) =>\n          oneApi({ name: key, version: versions[0] }).catch(() =>\n            onError(\n              `API ${key} with version ${versions[0]} not found or broken.`\n            )\n          )\n        );\n      } else {\n        return oneApi({ name: apiName || appName, version }).catch(() =>\n          onError(\n            `API ${\n              apiName || appName\n            } with version ${version} not found or broken.`\n          )\n        );\n      }\n    });\n\n  Promise.all(flatten(allFiles)).then((files) => {\n    if (files && files.length > 1) {\n      files.map(({ name, ...file } = {}) => {\n        if (name) {\n          delete file.latest;\n          zip.file(`${name}-openapi.json`, JSON.stringify(file));\n        }\n      });\n      zip\n        .generateAsync({ type: 'blob' })\n        .then((content) => fileDownload(content, `cloud-services-openapi.zip`));\n    } else if (files && files.length === 1) {\n      const { name, ...file } = files[0] || {};\n      if (name) {\n        delete file.latest;\n        fileDownload(JSON.stringify(file), `${name}-openapi.json`);\n      }\n    }\n  });\n}\n","import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  PageHeader,\n  PageHeaderTitle,\n  Main,\n  SkeletonTable,\n  TableToolbar,\n  PrimaryToolbar,\n} from '@redhat-cloud-services/frontend-components';\nimport {\n  TreeRowWrapper,\n  sizeCalculator,\n} from '@redhat-cloud-services/frontend-components/components/TreeTable';\nimport { Pagination } from '@patternfly/react-core';\nimport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableVariant,\n} from '@patternfly/react-table';\nimport { connect } from 'react-redux';\nimport { onLoadApis, onSelectRow } from '../store/actions';\nimport {\n  filterRows,\n  buildRows,\n  columns,\n  multiDownload,\n} from '../Utilities/overviewRows';\nimport { addNotification } from '@redhat-cloud-services/frontend-components-notifications/cjs/actions';\n\nconst isNotSelected = ({ selectedRows }) => {\n  return (\n    !selectedRows ||\n    Object.values(selectedRows || {})\n      .map(({ isSelected }) => isSelected)\n      .filter(Boolean).length === 0\n  );\n};\n\nconst Overview = ({ loadApis, services, selectRow, onError }) => {\n  useEffect(() => {\n    loadApis();\n  }, []);\n  const [openedRows, setOpenedRows] = useState([]);\n  const [sortBy, onSortBy] = useState({});\n  const [pageSettings, onPaginate] = useState({\n    perPage: 50,\n    page: 1,\n  });\n  const [filter, onChangeFilter] = useState('');\n  const filtered =\n    filter && services.endpoints.filter((row) => filterRows(row, filter));\n  const rows = services.loaded\n    ? buildRows(\n        sortBy,\n        pageSettings,\n        filtered || services.endpoints,\n        services.selectedRows,\n        openedRows\n      )\n    : [];\n  const onSetRows = (_e, { props: { value } }) => {\n    if (openedRows.includes(value)) {\n      setOpenedRows(() => openedRows.filter((opened) => opened !== value));\n    } else {\n      setOpenedRows(() => [...openedRows, value]);\n    }\n  };\n\n  return (\n    <React.Fragment>\n      <PageHeader className=\"pf-m-light\">\n        <PageHeaderTitle title=\"API documentation\" />\n      </PageHeader>\n      <Main className=\"ins-c-docs__api\">\n        <React.Fragment>\n          <PrimaryToolbar\n            filterConfig={{\n              items: [\n                {\n                  label: 'Filter by application name',\n                  type: 'text',\n                  filterValues: {\n                    id: 'filter-by-string',\n                    key: 'filter-by-string',\n                    placeholder: 'Filter by application name',\n                    value: filter,\n                    onChange: (_e, value) => {\n                      onPaginate({\n                        ...pageSettings,\n                        page: 1,\n                      });\n                      onChangeFilter(value);\n                    },\n                    isDisabled: !services.loaded,\n                  },\n                },\n              ],\n            }}\n            actionsConfig={{\n              actions: [\n                {\n                  label: 'Download selected',\n                  props: {\n                    isDisabled: isNotSelected(services),\n                    onClick: () =>\n                      multiDownload(services.selectedRows, onError),\n                  },\n                },\n              ],\n            }}\n            {...(services.loaded && {\n              pagination: {\n                ...pageSettings,\n                itemCount: (filtered || services.endpoints).length,\n                onSetPage: (_e, page) =>\n                  onPaginate({\n                    ...pageSettings,\n                    page,\n                  }),\n                onPerPageSelect: (_event, perPage) =>\n                  onPaginate({\n                    ...pageSettings,\n                    perPage,\n                  }),\n              },\n            })}\n            {...(filter.length > 0 && {\n              activeFiltersConfig: {\n                filters: [\n                  {\n                    name: filter,\n                  },\n                ],\n                onDelete: () => {\n                  onPaginate({\n                    ...pageSettings,\n                    page: 1,\n                  });\n                  onChangeFilter('');\n                },\n              },\n            })}\n          />\n          {services.loaded ? (\n            <Table\n              className=\"pf-m-expandable pf-c-treeview\"\n              aria-label=\"Sortable Table\"\n              variant={TableVariant.compact}\n              sortBy={sortBy}\n              onSort={(_e, index, direction) => onSortBy({ index, direction })}\n              cells={columns(onSetRows)}\n              rows={sizeCalculator(rows)}\n              rowWrapper={TreeRowWrapper}\n              {...((filtered || services.endpoints).length > 0 && {\n                onSelect: (_e, isSelected, rowKey) => {\n                  if (rowKey === -1) {\n                    selectRow(isSelected, rows);\n                  } else {\n                    selectRow(isSelected, rows[rowKey]);\n                  }\n                },\n              })}\n            >\n              <TableHeader />\n              <TableBody />\n            </Table>\n          ) : (\n            <SkeletonTable columns={columns} rowSize={28} />\n          )}\n        </React.Fragment>\n        <TableToolbar isFooter>\n          {services.loaded ? (\n            <Pagination\n              variant=\"bottom\"\n              dropDirection=\"up\"\n              itemCount={(filtered || services.endpoints).length}\n              perPage={pageSettings.perPage}\n              page={pageSettings.page}\n              onSetPage={(_e, page) =>\n                onPaginate({\n                  ...pageSettings,\n                  page,\n                })\n              }\n              onPerPageSelect={(_event, perPage) =>\n                onPaginate({\n                  ...pageSettings,\n                  perPage,\n                })\n              }\n            />\n          ) : (\n            `loading`\n          )}\n        </TableToolbar>\n      </Main>\n    </React.Fragment>\n  );\n};\n\nOverview.propTypes = {\n  loadApis: PropTypes.func,\n  onError: PropTypes.func,\n  services: PropTypes.shape({\n    loaded: PropTypes.bool,\n    selectedRows: PropTypes.shape({\n      isSelected: PropTypes.bool,\n    }),\n    endpoints: PropTypes.arrayOf(\n      PropTypes.shape({\n        [PropTypes.string]: PropTypes.oneOfType([\n          PropTypes.string,\n          PropTypes.number,\n          PropTypes.bool,\n          PropTypes.node,\n        ]),\n      })\n    ),\n  }),\n  history: PropTypes.shape({\n    push: PropTypes.func,\n  }),\n  selectRow: PropTypes.func,\n};\nOverview.defaultProps = {\n  loadApis: () => undefined,\n  selectRow: () => undefined,\n  onError: () => undefined,\n  services: {\n    loaded: false,\n    selectedRows: {},\n  },\n};\n\nexport default connect(\n  ({ services }) => ({\n    services,\n  }),\n  (dispatch) => ({\n    loadApis: () => dispatch(onLoadApis()),\n    selectRow: (isSelected, row) => dispatch(onSelectRow({ isSelected, row })),\n    onError: (error) =>\n      dispatch(\n        addNotification({\n          variant: 'danger',\n          title: 'Server error',\n          description: error,\n          dismissable: true,\n        })\n      ),\n  })\n)(Overview);\n"],"sourceRoot":""}